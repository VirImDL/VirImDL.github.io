<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Murrell Group Code</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- Add favicon using inline SVG -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M20,80 L20,20 L50,50 L80,20 L80,80' stroke='%238b5cf6' stroke-width='8' fill='none' stroke-linecap='round' stroke-linejoin='round'/></svg>" type="image/svg+xml">
  
  <!-- Typography -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* ---------- Theme palette ---------- */
    :root {
      /* Light mode - improved header contrast */
      --bg-primary: #fcfaff;
      --bg-secondary: #ffffff;
      --nav-bg: #f5f0ff;
      --header-bg: #5b46e5;  /* Solid color instead of gradient for better contrast */
      --header-text: #ffffff;
      --text-primary: #2d3748;
      --text-secondary: #5a5582;
      --accent: #8b5cf6;
      --accent-hover: #7c3aed;
      --card-bg: #ffffff;
      --card-border: #f0e7ff;
      --card-border-hover: #d8b4fe;
      --section-heading: #4c1d95;
      --nav-active-bg: #ede9fe;
      --nav-active-text: #6d28d9;
      --shadow: 0 4px 14px rgba(124, 58, 237, 0.08);
      --radius: 10px;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        /* More neutral, less alarming dark mode */
        --bg-primary: #1e1e2a;
        --bg-secondary: #25252f;
        --nav-bg: #25252f;
        --header-bg: #4f46e5;  /* Slightly lighter indigo */
        --header-text: #ffffff;
        --text-primary: #e2e8f0;
        --text-secondary: #a0aec0;  /* More neutral gray with slight cool tone */
        --accent: #a78bfa;  /* CHANGED: Much lighter purple for better contrast */
        --accent-hover: #8b5cf6;
        --card-bg: #25252f;
        --card-border: #32323e;
        --card-border-hover: #3e3e4a;
        --section-heading: #d8d8f8;  /* Less saturated heading */
        --nav-active-bg: #3c347d;
        --nav-active-text: #c7c7f7;  /* Less saturated active text */
        --shadow: 0 4px 14px rgba(0, 0, 0, 0.15);
      }
    }

    /* ---------- Reset & base ---------- */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* ---------- Header ---------- */
    header {
      background-color: var(--header-bg);
      color: var(--header-text);
      padding: 1.25rem 2rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    h1 {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
    }

    /* ---------- Layout ---------- */
    .container {
      display: flex;
      flex: 1;
    }

    /* ---------- Sidebar ---------- */
    .sidebar {
      background-color: var(--nav-bg);
      width: 280px;
      padding: 1.5rem;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      flex-shrink: 0; /* Prevent sidebar from shrinking */
    }

    .sidebar-heading {
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .nav-list {
      list-style: none;
    }

    .nav-item {
      margin-bottom: 0.5rem;
    }

    .nav-link {
      display: block;
      padding: 0.75rem 1rem;
      border-radius: var(--radius);
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .nav-link:hover {
      background-color: rgba(0,0,0,0.05);
    }

    .nav-link.active {
      background-color: var(--nav-active-bg);
      color: var(--nav-active-text);
      font-weight: 600;
    }

    /* ---------- Main content ---------- */
    .content {
      flex: 1;
      padding: 2rem;
      min-width: 0; /* Allow content to shrink */
    }

    .section {
      margin-bottom: 3rem;
    }

    /* Default layout - image next to text */
    .section-header {
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--card-border);
    }

    .section-title {
      font-size: 1.75rem;
      font-weight: 600;
      color: var(--section-heading);
      margin: 0;
      margin-right: 1rem; /* Add space between title and image */
    }

    /* ---------- Repository grid ---------- */
    .repo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.25rem;
    }

    .repo-card {
      background-color: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: var(--radius);
      transition: all 0.2s ease;
      box-shadow: var(--shadow);
      overflow: hidden; /* Ensure image corners respect border-radius */
      display: flex;
      flex-direction: column; /* Stack content and image */
    }

    .repo-card:hover {
      border-color: var(--card-border-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }

    /* Container for the text content (title, desc) */
    .repo-content {
        padding: 1.25rem 1.25rem 0 1.25rem; /* Add padding top/sides */
        display: flex;
        flex-direction: column;
        flex-grow: 1; /* Allow content area to grow */
        margin-bottom: 1rem; /* Add space between text and image */
    }

    .repo-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.75rem;
    }

    .repo-title a {
      color: var(--accent);
      text-decoration: none;
    }

    .repo-title a:hover {
      color: var(--accent-hover);
      text-decoration: underline;
    }

    .repo-desc {
      color: var(--text-secondary);
      font-size: 0.9375rem;
      flex-grow: 1; /* Pushes image down if description is short */
    }

    /* Container for the image at the bottom */
    .repo-image-container {
       width: 100%; /* Span the full width */
       line-height: 0; /* Prevent extra space below image */
       /* margin-top: auto; Pushes image to bottom */
    }

    /* Style for the actual image element */
    .repo-image-container img {
        display: block; /* Remove extra space below image */
        width: 100%;   /* Make image scale to container width */
        height: auto;  /* Maintain aspect ratio */
        object-fit: cover; /* Or 'contain' */
        /* The overflow: hidden on .repo-card handles bottom corner radius */
    }

    /* ---------- New Text styles ---------- */
    .page-introduction {
      margin-bottom: 2rem;
      background-color: transparent;
      border-radius: 0;
      padding: 0;
      box-shadow: none;
      border: none;
      color: var(--text-primary);
      font-size: 1.1rem;
      line-height: 1.6;
    }

    .category-description {
      margin-top: -0.5rem;
      margin-bottom: 1.5rem;
      color: var(--text-secondary);
      font-size: 1rem;
      line-height: 1.6;
    }

    /* ---------- Responsive adjustments ---------- */
    @media (max-width: 1024px) { /* Adjust breakpoint if needed */
        .container {
            flex-direction: column;
        }
        .sidebar {
            width: 100%;
            height: auto; /* Allow sidebar height to adjust */
            position: static; /* Remove sticky positioning */
            padding: 1rem;
            border-bottom: 1px solid var(--card-border); /* Add separator */
        }
        .content {
            padding: 1.5rem;
        }
    }

    @media (max-width: 768px) {
      .repo-grid {
        grid-template-columns: 1fr; /* Stack cards on smaller screens */
      }
      .content {
          padding: 1rem; /* Slightly less padding on mobile */
      }
      .repo-content {
          padding: 1rem 1rem 0 1rem; /* Adjust padding for mobile */
          margin-bottom: 1rem;
      }
      .repo-title {
          font-size: 0.95rem; /* Slightly smaller title */
      }
      .repo-desc {
          font-size: 0.9rem; /* Slightly smaller description */
      }
    }

    /* GitHub icon */
    .gh-icon {
      width: 16px;
      height: 16px;
      fill: currentColor;
      flex-shrink: 0; /* Prevent icon from shrinking */
    }

    /* Footer styles */
    .footer {
      background-color: var(--nav-bg);
      color: var(--text-secondary);
      padding: 1rem 2rem;
      text-align: center;
      margin-top: 2rem;
      border-top: 1px solid var(--card-border);
    }
    
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .footer a {
      color: var(--accent);
      text-decoration: none;
    }
    
    .footer a:hover {
      text-decoration: underline;
      color: var(--accent-hover);
    }
  </style>
</head>
<body>
  <header>
    <h1>Murrell Group @ KI</h1>
  </header>

  <div class="container">
    <aside class="sidebar">
      <div class="sidebar-heading">Categories</div>
      <ul class="nav-list" id="nav-list">
        <!-- Navigation will be inserted here -->
      </ul>
    </aside>

    <main class="content" id="content">
      <!-- Content will be inserted here -->
    </main>
  </div>

  <!-- Add this new footer section before the script tag -->
  <footer class="footer">
    <div class="footer-content">
      <p>Contact: <a href="mailto:benjamin.murrell@ki.se">benjamin.murrell@ki.se</a> | Division of Virology and Immunology, MTC, Karolinska</p>
    </div>
  </footer>

  <script>
  /*
   * --------------------------------------------------------------------
   *   Maintain the catalogue below. Add / remove entries – that's it.
   * --------------------------------------------------------------------
   */
  
  // Add top-level page text here
  const pageIntroduction = `
    <p>A collection of (mostly) Julia packages developed in the Murrell lab at MTC, Karolinska.</p>
  `;
  
  const catalogue = [
    {
      category: "Phylogenetics",
      id: "phylo",
      repos: [
      {name:"MolecularEvolution.jl", url:"https://github.com/MurrellGroup/MolecularEvolution.jl", desc:"A flexible framework for phylogenetic model development and inference.", imageUrl: "https://github.com/user-attachments/assets/80d60d7c-7317-4ecb-8536-f6c13d7990ee"},
      {name:"CodonMolecularEvolution.jl", url:"https://github.com/MurrellGroup/CodonMolecularEvolution.jl", desc:"A collection of bleeding-edge codon models.", imageUrl: "https://github.com/user-attachments/assets/6ec35dc3-f59e-4da4-a484-0397646a069b"}, // Added example image
      ]
    },
    {
      category: "DL Frameworks",
      id: "frameworks",
      repos: [
      {name:"Flowfusion.jl", url:"https://github.com/MurrellGroup/Flowfusion.jl", desc:"Unifying diffusion and flow matching on Euclidean & discrete spaces, and Riemannian manifolds, for generative deep learning.", imageUrl: "https://github.com/user-attachments/assets/ff7f25e6-441d-4840-ac9c-a849e7b57aa7"},
      {name:"ForwardBackward.jl", url:"https://github.com/MurrellGroup/ForwardBackward.jl", desc:"Math and algorithms for sampling from and inference under stochastic processes.", imageUrl: "https://github.com/user-attachments/assets/9d4087b7-b9ab-4e1a-9459-8818e3a083cb"}, // Added example image      
      ]
    },
    {
      category: "Layers",
      id: "neural-layers",
      //description: "Specialized neural network layers designed for biological data processing. These components can be combined with standard layers to create models tailored to specific biological problems.",
      repos: [
        {name:"Onion.jl", url:"https://github.com/MurrellGroup/Onion.jl", desc:"A collection of useful layers.", imageUrl: "https://github.com/user-attachments/assets/f387acd5-cb24-4796-af1e-c293eb4c06b9"},
        {name:"LowRankLayers.jl", url:"https://github.com/MurrellGroup/LowRankLayers.jl", desc:"Low‑rank adapters to piggyback upon Dense layers (useful for finetuning).", imageUrl: "https://github.com/user-attachments/assets/d1b62d29-13c8-4a7e-8ba0-28fd3c75ed06"},
        {name:"RandomFeatureMaps.jl", url:"https://github.com/MurrellGroup/RandomFeatureMaps.jl", desc:"Random projection layers with no trainable parameters.", imageUrl: "https://github.com/user-attachments/assets/cf0784bc-4730-4fe1-8075-f169d1cd2d43"},
        {name:"ConditionalDensityLayers.jl", url:"https://github.com/MurrellGroup/ConditionalDensityLayers.jl", desc:"Mapping an embedding to a continuous density." , imageUrl: "https://github.com/user-attachments/assets/8498decf-9deb-4425-a69c-6db7c7c0a1d7"},
      ]
    },
    {
      category: "Large Language Models",
      id: "llms",
      //description: "Implementation and adaptation of language model architectures for biological sequence analysis. These models leverage techniques from NLP for understanding protein and genomic sequences.",
      repos: [
      {name:"Jjama3.jl", url:"https://github.com/MurrellGroup/Jjama3.jl", desc:"A pure-Julia implementation of the Llama3 model family (and more).", imageUrl: "https://github.com/user-attachments/assets/5749604f-3fb8-413b-be36-27876527ef45"},
      {name:"LogitSamplers.jl", url:"https://github.com/MurrellGroup/LogitSamplers.jl", desc:"Transform your logits. Top-p, top-k, and more.", imageUrl: "https://github.com/user-attachments/assets/050cc1df-8761-4ca4-89c2-e8f12a0a66f0"},
      {name:"HuggingFaceTransformers.jl", url:"https://github.com/MurrellGroup/HuggingFaceTransformers.jl", desc:"Julia wrapper for HuggingFace Transformers in Julia."},
      {name:"HuggingFaceTokenizers.jl", url:"https://github.com/MurrellGroup/HuggingFaceTokenizers.jl", desc:"Julia wrapper for HuggingFace Tokenizers in Julia."}
      ]
    },
    {
      category: "Rotation and translation invariance",
      id: "rototrans",
      //description: "Libraries for handling 3D spatial transformations in neural networks. Particularly useful for protein structure prediction and molecule modeling where spatial orientation matters.",
      repos: [
      {name:"RotationMap.jl", url:"https://github.com/MurrellGroup/RotationMap.jl", desc:"A differentiable parameterization of SO(3) rotations (from `An analysis of svd for deep rotation estimation`).", imageUrl: "https://github.com/user-attachments/assets/79011b22-16ad-4bd4-aae4-569a264c334c"},
        {name:"InvariantPointAttention.jl", url:"https://github.com/MurrellGroup/InvariantPointAttention.jl", desc:"AlphaFold 2's IPA, with extra tricks (softmax1, and block-wise RoPE).", imageUrl: "https://github.com/user-attachments/assets/66550f27-a6f2-44e4-878e-d94b59c3488d"}, // Placeholder
        {name:"MessagePassingIPA.jl", url:"https://github.com/MurrellGroup/MessagePassingIPA.jl", desc:"IPA, but for graph neural networks.", imageUrl: "https://github.com/user-attachments/assets/dc19db9a-c5fe-468d-b25b-1d1a430a385d"},
        {name:"BatchedTransformations.jl", url:"https://github.com/MurrellGroup/BatchedTransformations.jl", desc:"An interface for applying transformations to data in batches.", imageUrl: "https://github.com/user-attachments/assets/2a700892-7a4a-4922-be31-a2f9016dfb14"},
        
      ]
    },
    {
      category: "Optimization",
      id: "optimization",
      //description: "Tools for training deep learning models.",
      repos: [
      {name:"CannotWaitForTheseOptimisers.jl", url:"https://github.com/MurrellGroup/CannotWaitForTheseOptimisers.jl", desc:"Bleeding edge experimental optimisers, including Muon and Apollo", imageUrl: "https://github.com/user-attachments/assets/8dd9cc42-db3b-4d75-8d91-dcf908aa5fee"},
      {name:"LearningSchedules.jl", url:"https://github.com/MurrellGroup/LearningSchedules.jl", desc:"Simple learning rate schedules.", imageUrl: "https://github.com/user-attachments/assets/47bd0a3c-84c5-4c78-a1f9-21cb02c49e23"},
      ]
    },
    {
      category: "Protein-specific packages",
      id: "protein-models",
      //description: "Tools specifically designed for protein structure analysis, visualization, and modeling. These libraries complement our more general-purpose frameworks when working with protein data.",
      repos: [
      {name:"ProteinChains.jl", url:"https://github.com/MurrellGroup/ProteinChains.jl", desc:"Convert PDB entries to deep-learning compatible data structures.", imageUrl: "https://github.com/user-attachments/assets/8861edc7-9344-4512-b25c-bd583b324103"},
      {name:"BackboneIdealization.jl", url:"https://github.com/MurrellGroup/BackboneIdealization.jl", desc:"Differentiable idealisation of backbone geometry - useful for dihedral models", imageUrl: "https://github.com/user-attachments/assets/771b3274-580e-4823-a2d3-b0c95aadecec"},
      {name:"AssigningSecondaryStructure.jl", url:"https://github.com/MurrellGroup/AssigningSecondaryStructure.jl", desc:"Julia implementation of a simplified DSSP algorithm.", imageUrl: "https://github.com/user-attachments/assets/be5167b9-e67d-4584-a750-2d81abeb2d8f"},
      {name:"ProtPlot.jl", url:"https://github.com/MurrellGroup/ProtPlot.jl", desc:"Makie‑based protein attention maps and ribbon plots.", imageUrl: "https://github.com/user-attachments/assets/35f74a99-00be-4c01-bb56-8508bf0951d2"},
      {name:"Boltz1.jl - a wrapper", url:"https://github.com/MurrellGroup/Boltz1.jl", desc:"Julia wrapper for the Boltz‑1 diffusion‑folding model."},
      {name:"ColabMPNN.jl - a wrapper", url:"https://github.com/MurrellGroup/ColabMPNN.jl", desc:"Julia wrapper for the ColabDesign version of ProteinMPNN."},
      {name:"TMscore.jl - a wrapper", url:"https://github.com/MurrellGroup/TMscore.jl", desc:"Julia wrapper for TM‑score calculations."},
      ]
    },
    {
      category: "Utils",
      id: "utils",
      //description: "Tools for visualizing and embedding complex biological data. These libraries help researchers gain insights from high-dimensional data and communicate findings effectively.",
      repos: [
        {name:"MergedArrays.jl", url:"https://github.com/MurrellGroup/MergedArrays.jl", desc:"Concatenates arrays, to circumvent a Julia GC slowdown when you have millions of references.", imageUrl: "https://github.com/user-attachments/assets/58e54e05-1f55-48cb-ac2a-b2d9eb5824af"}
      ]
    },
    {
      category: "Visualisation & embedding tools",
      id: "visualization-tools",
      //description: "Tools for visualizing and embedding complex biological data. These libraries help researchers gain insights from high-dimensional data and communicate findings effectively.",
      repos: [
        {name:"SeqUMAP.jl", url:"https://github.com/MurrellGroup/SeqUMAP.jl", desc:"UMAP, but for variable-length nucleotide and amino acid sequences", imageUrl: "https://github.com/user-attachments/assets/de3c55e5-0824-4cc0-a6ff-45739b225ed0"}
      ]
    },
    {
      category: "SARS-CoV-2 Variant Models",
      id: "coviddynamics",
      repos: [
      {name:"SARS-CoV-2 Lineage Competition", url:"https://github.com/MurrellGroup/lineages", desc:"Results for a Bayesian model of global SARS-CoV-2 lineage competition.", imageUrl: "https://github.com/user-attachments/assets/731df70a-042a-4461-af7d-3d8c9f8bb63f"},
      {name:"MultinomialLogisticGrowth", url:"https://github.com/MurrellGroup/MultinomialLogisticGrowth", desc:"For fitting multinomial logistic growth models to variant data.", imageUrl: "https://github.com/user-attachments/assets/d37aced7-77b5-4d29-9a9a-e0123f7d44a8"}, // Added example image
      ]
    },
    {
      category: "NGS analysis",
      id: "ngs",
      repos: [
      {name:"Nanobody Miner", url:"https://github.com/MurrellGroup/NanobodyMiner", desc:"A julia package for repertoire scale nanobody enrichment analysis.", imageUrl: "https://github.com/user-attachments/assets/db7ecf54-2c6f-42c9-8822-54c2d6e6410b"},
      {name:"CHMMera.jl", url:"https://github.com/MurrellGroup/CHMMera.jl", desc:"Fast chimera detection with HMMs.", imageUrl: "https://github.com/user-attachments/assets/ebc83f6e-1a3c-4bf0-abab-77efd08d8d7e"},
      {name:"CHMMairra.jl", url:"https://github.com/MurrellGroup/CHMMairra.jl", desc:"Using CHMMera.jl for detecting PCR-induced recombinants in immune repertoire datasets.", imageUrl: "https://github.com/user-attachments/assets/a3286a1b-0739-4e9f-80ba-4b2f3e4c3e05"},
      {name:"PORPID.jl", url:"https://github.com/MurrellGroup/PORPID.jl", desc:"For the analysis of UMI/PID-tagged long read viral sequencing data.", imageUrl: "https://github.com/user-attachments/assets/b1164547-406f-42b3-b345-6dde64c0cf4a"},
      {name:"PORPIDpipeline", url:"https://github.com/MurrellGroup/PORPIDpipeline", desc:"A snakemake pipeline for PORPID, with postprocessing.", imageUrl: "https://github.com/user-attachments/assets/3bf62874-06e4-41d4-aa23-6ed50bbc6285"}
      ]
    }
  ];

  /* Render navigation */
  const navList = document.getElementById('nav-list');
  let activeCategory = catalogue[0].id; // Keep track of active category

  catalogue.forEach((cat, index) => {
    const li = document.createElement('li');
    li.className = 'nav-item';

    const a = document.createElement('a');
    a.className = 'nav-link';
    if (index === 0) a.className += ' active';
    a.href = '#' + cat.id;
    a.textContent = cat.category;
    a.dataset.category = cat.id; // Use data attribute for easier selection

    a.addEventListener('click', (e) => {
      e.preventDefault(); // Prevent default jump

      // Update active state in nav
      document.querySelectorAll('.nav-link.active').forEach(link => {
        link.classList.remove('active');
      });
      e.target.classList.add('active');

      // Update active category variable
      activeCategory = cat.id;

      // Scroll to the section smoothly
      const section = document.getElementById(cat.id);
      if (section) {
        // Calculate offset considering fixed header if needed
        const headerOffset = document.querySelector('header')?.offsetHeight || 0;
        // Adjust for potential top padding/margin of the content area if needed
        const elementPosition = section.getBoundingClientRect().top + window.scrollY;
        const offsetPosition = elementPosition - headerOffset - 20; // Extra 20px padding

        window.scrollTo({
             top: offsetPosition,
             behavior: "smooth"
        });
      }
    });

    li.appendChild(a);
    navList.appendChild(li);
  });

  /* Render content */
  const contentContainer = document.getElementById('content');
  
  // Add page introduction if defined
  if (pageIntroduction) {
    const introSection = document.createElement('div');
    introSection.className = 'page-introduction';
    introSection.innerHTML = pageIntroduction;
    contentContainer.appendChild(introSection);
  }

  catalogue.forEach(cat => {
    // Create section
    const section = document.createElement('section');
    section.className = 'section';
    section.id = cat.id;

    // Create section header
    const sectionHeader = document.createElement('div');
    sectionHeader.className = 'section-header';

    // Create section title
    const title = document.createElement('h2');
    title.className = 'section-title';
    title.textContent = cat.category;
    sectionHeader.appendChild(title);

    section.appendChild(sectionHeader);
    
    // Add category description if available
    if (cat.description) {
      const description = document.createElement('div');
      description.className = 'category-description';
      description.innerHTML = cat.description;
      section.appendChild(description);
    }

    // Create repo grid
    const repoGrid = document.createElement('div');
    repoGrid.className = 'repo-grid';

    // Add repos to grid
    cat.repos.forEach(repo => {
      const card = document.createElement('div');
      card.className = 'repo-card';

      // --- Create elements ---
      // Content first
      const repoContentDiv = document.createElement('div'); // Container for text content
      const repoTitleDiv = document.createElement('div');
      const repoLink = document.createElement('a');
      const icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      const repoDescDiv = document.createElement('div');

      // Image elements (conditionally created)
      const repoImageContainer = repo.imageUrl ? document.createElement('div') : null;
      const repoImage = repo.imageUrl ? document.createElement('img') : null;


      // --- Configure Content Elements ---
      repoContentDiv.className = 'repo-content';

      // Title container
      repoTitleDiv.className = 'repo-title';

      // Link
      repoLink.href = repo.url;
      repoLink.target = '_blank';
      repoLink.rel = 'noopener noreferrer';

      // GitHub Icon
      icon.setAttribute('class', 'gh-icon');
      icon.setAttribute('viewBox', '0 0 16 16');
      icon.setAttribute('aria-hidden', 'true');
      path.setAttribute('d', 'M8 0C3.58 0 0 3.58 0 8a8 8 0 005.47 7.59c.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82A7.65 7.65 0 018 4.58c.68.003 1.36.092 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0016 8c0-4.42-3.58-8-8-8z');
      icon.appendChild(path);

      // Assemble Link
      repoLink.appendChild(icon);
      repoLink.appendChild(document.createTextNode(' ' + repo.name)); // Add space

      // Assemble Title
      repoTitleDiv.appendChild(repoLink);

      // Description
      repoDescDiv.className = 'repo-desc';
      repoDescDiv.textContent = repo.desc;

      // Assemble Content Area
      repoContentDiv.appendChild(repoTitleDiv);
      repoContentDiv.appendChild(repoDescDiv);

      // --- Configure Image Elements (if they exist) ---
      if (repoImageContainer && repoImage) {
        repoImageContainer.className = 'repo-image-container';
        repoImage.src = repo.imageUrl;
        repoImage.alt = repo.name + ' preview'; // Add alt text
        repoImage.loading = 'lazy'; // Lazy load images
        repoImageContainer.appendChild(repoImage);
      }

      // --- Append elements to card in order ---
      card.appendChild(repoContentDiv); // Content area first
      if (repoImageContainer) {
        card.appendChild(repoImageContainer); // Then image container (at the bottom)
      }

      repoGrid.appendChild(card);
    });

    section.appendChild(repoGrid);
    contentContainer.appendChild(section);
  });

  /* Scroll spy for navigation */
  // Debounce function to limit scroll handler frequency
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  const scrollHandler = debounce(() => {
    const sections = document.querySelectorAll('.section');
    let bestMatch = '';
    let smallestDistance = Infinity;
    const viewportCenter = window.innerHeight / 2;

    sections.forEach(section => {
      const rect = section.getBoundingClientRect();
      // Calculate distance from the top of the section to the center of the viewport
      // Give slightly more weight to sections closer to the top
      const distance = Math.abs(rect.top - viewportCenter * 0.5);

      // Check if the section is at all visible or near the viewport center
      if (rect.top < window.innerHeight && rect.bottom > 0 && distance < smallestDistance) {
          smallestDistance = distance;
          bestMatch = section.getAttribute('id');
      }
    });

    if (bestMatch && bestMatch !== activeCategory) {
      // Update navigation only if the best matching section is different
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.dataset.category === bestMatch) {
          link.classList.add('active');
        }
      });
      activeCategory = bestMatch; // Update the tracked active category
    } else if (!bestMatch && window.scrollY === 0) {
        // Special case: If scrolled to the very top, activate the first category
        const firstCategoryId = catalogue[0].id;
         if (firstCategoryId !== activeCategory) {
             document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.category === firstCategoryId) {
                    link.classList.add('active');
                }
            });
            activeCategory = firstCategoryId;
         }
    }
  }, 50); // Run at most every 50ms

  window.addEventListener('scroll', scrollHandler);
  // Initial call to set correct state on load
  scrollHandler();

  </script>
</body>
</html>
